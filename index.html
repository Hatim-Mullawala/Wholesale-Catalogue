<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wholesale Catalogue - Hatimi Hardware</title>
    <style>
    /* General Styles */
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f4f4f4; }
    
    /* Category Headers */
    .category-header { 
        background: #333; color: white; padding: 15px; 
        font-size: 1.2rem; font-weight: bold; position: sticky; top: 0; z-index: 10;
    }

    /* The Responsive Grid */
    .product-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
        gap: 10px; padding: 10px; 
    }

    /* Product Card */
    .product-card { 
        background: white; border-radius: 8px; padding: 12px; 
        display: flex; flex-direction: column; justify-content: space-between;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
    }

    .img-holder { 
        width: 100%; height: 150px; display: flex; 
        align-items: center; justify-content: center; margin-bottom: 10px; 
    }

    .img-holder img { max-width: 100%; max-height: 100%; object-fit: contain; }

    .p-brand { font-size: 0.8rem; color: #777; text-transform: uppercase; font-weight: bold; }
    .p-name { font-size: 1rem; font-weight: bold; margin: 4px 0; color: #222; }
    .p-specs { font-size: 0.85rem; color: #555; margin-bottom: 10px; }

    /* Mobile-Friendly WhatsApp Button */
    .btn-request { 
        display: block; background: #25D366; color: white; 
        text-align: center; padding: 10px; border-radius: 5px; 
        text-decoration: none; font-weight: bold; font-size: 0.9rem;
    }

    /* Mobile Specific Adjustments */
    @media (max-width: 480px) {
        .product-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 8px; }
        .p-name { font-size: 0.9rem; }
        .category-header { font-size: 1rem; padding: 10px; }
        .img-holder { height: 120px; }
    }
</style>
</head>
<body>

<div class="search-container">
    <input type="text" id="searchInput" class="search-box" placeholder="Search product or brand..." onkeyup="filterProducts()">
</div>

<div class="main-wrapper">
    <header class="catalog-header">
        <div class="logo-section">
            <img src="logo.png" class="logo-img" alt="Logo" onerror="this.src='https://via.placeholder.com/80'">
            <div>
                <h1 class="brand-name">Hatimi Hardware</h1>
                <p class="tagline">Quality Fittings â€¢ Trusted Tools</p>
            </div>
        </div>
        <div class="action-buttons">
            <button class="icon-btn" onclick="location.reload()"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#b38728" d="M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15V18M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z"/></svg></button>
            <button class="icon-btn" onclick="window.print()"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#b38728" d="M18,3H6V7H18M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12M16,19H8V14H16M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8Z"/></svg></button>
        </div>
    </header>

    <div id="catalog-container">
        <p style="text-align:center; padding: 50px;">Syncing Wholesale Catalogue...</p>
    </div>
</div>

<script>
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRqfLPTM9QCajpUToFw0B2UTKUIv-0d3P5ldQxLWKYfD98PPVf5ZEDXITZuTrdNPh8D8dDKcJxO1D4O/pub?gid=897547923&single=true&output=csv';

    let allProducts = [];

    // IMPROVED PARSER: Keeps quotes inside the text but removes outer wrapping quotes
    function parseCSVLine(line) {
        const result = [];
        let cell = '';
        let inQuotes = false;
        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            if (char === '"' && line[i+1] === '"') { // Handles escaped double quotes ""
                cell += '"';
                i++;
            } else if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                result.push(cell.trim());
                cell = '';
            } else {
                cell += char;
            }
        }
        result.push(cell.trim());
        return result;
    }

    async function loadData() {
        try {
            const response = await fetch(sheetURL);
            const data = await response.text();
            // Splits rows and removes empty lines
            const rows = data.split('\n').filter(r => r.trim() !== '').slice(1);
            
            allProducts = rows.map(row => {
                const cols = parseCSVLine(row); 
                return { 
                    cat: cols[0] || 'Uncategorized', // Column A
                    brand: cols[1] || '',           // Column B
                    name: cols[2] || '',            // Column C
                    specs: cols[3] || '',           // Column D
                    key: cols[4] || ''              // Column E
                };
            });

            // ASCENDING SORTING LOGIC:
            // 1. Sort by Category (A-Z)
            // 2. Sort by Product Name (A-Z) within that category
            allProducts.sort((a, b) => {
                if (a.cat !== b.cat) {
                    return a.cat.localeCompare(b.cat);
                }
                return a.name.localeCompare(b.name);
            });

            renderGrid(allProducts);
        } catch (e) { 
            document.getElementById('catalog-container').innerHTML = "Error loading data."; 
        }
    }

    async function loadData() {
        try {
            const response = await fetch(sheetURL);
            const data = await response.text();
            // Splits rows and removes empty lines
            const rows = data.split('\n').filter(r => r.trim() !== '').slice(1);
            
            allProducts = rows.map(row => {
                const cols = parseCSVLine(row); 
                return { 
                    cat: cols[0],    // Column A: Category
                    brand: cols[1],  // Column B: Brand
                    name: cols[2],   // Column C: Product Name
                    specs: cols[3],  // Column D: Specifications
                    key: cols[4]     // Column E: Keyword (Image Master)
                };
            });
            renderGrid(allProducts);
        } catch (e) { 
            document.getElementById('catalog-container').innerHTML = "Error loading data."; 
        }
    }

    function renderGrid(products) {
    const container = document.getElementById('catalog-container');
    let currentCat = "";
    let html = "";

    products.forEach(p => {
        if (p.cat !== currentCat) {
            if (html !== "") html += `</div>`;
            currentCat = p.cat;
            html += `<div class="category-header">${currentCat}</div><div class="product-grid">`;
        }

        const clean = (t) => (t || '').toString().toLowerCase().trim()
            .replace(/["']/g, '')       
            .replace(/[,\s./_]+/g, '-') 
            .replace(/-+/g, '-')        
            .replace(/^-|-$/g, '');

        const b = clean(p.brand);
        const n = clean(p.name);
        const s = clean(p.specs);
        const k = clean(p.key);

        // THE 4-STEP SEARCH ORDER:
        // 1. Brand + Name + Specs (Newest)
        // 2. Brand + Name         (Brand Specific)
        // 3. Name Only            (General)
        // 4. Keyword              (Shared)
        
        const img1 = `wholesale/${b}-${n}-${s}.jpg`;
        const img2 = `wholesale/${b}-${n}.jsg`; // Fixed typo to .jpg in actual logic
        const img3 = `wholesale/${n}.jpg`;
        const img4 = `wholesale/${k}.jpg`;

        html += `
            <div class="product-card">
                <div class="img-holder">
                    <img src="${img1}" 
                         onerror="this.src='wholesale/${b}-${n}.jpg'; this.onerror=function(){this.src='wholesale/${n}.jpg'; this.onerror=function(){this.src='wholesale/${k}.jpg'; this.onerror=function(){this.src='https://via.placeholder.com/150?text=Photo+Coming+Soon'};}}">
                </div>
                <div class="p-brand">${p.brand}</div>
                <div class="p-name">${p.name}</div>
                <div class="p-specs">${p.specs}</div>
                <a href="https://wa.me/919406648766" class="btn-request">Request Price</a>
            </div>`;
    });
    container.innerHTML = html + "</div>";
}

    function filterProducts() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allProducts.filter(p => p.name.toLowerCase().includes(term) || p.brand.toLowerCase().includes(term));
        renderGrid(filtered);
    }
    loadData();
</script>
</body>
</html>